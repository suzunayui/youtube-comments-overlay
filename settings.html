<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<title>YouTube Chat Overlay è¨­å®š</title>
<style>
  body {
    margin: 0;
    padding: 12px;
    font-family: "Yu Gothic", "Meiryo", sans-serif;
    background: #1e1e2f;
    color: #f5f5f5;
    overflow-x: hidden;
  }

  .container {
    display: flex;
    gap: 12px;
    height: calc(100vh - 24px);
    overflow: hidden;
  }

  .left-panel {
    flex: 0 0 240px;
    min-width: 200px;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
  }

  .right-panel {
    flex: 1;
    min-width: 0;
    overflow-y: auto;
  }

  .settings-row {
    display: flex;
    gap: 10px;
  }

  .settings-col {
    flex: 1;
    min-width: 0;
  }

  h1 {
    font-size: 18px;
    margin: 0 0 8px 0;
  }

  label {
    display: block;
    margin-top: 8px;
    font-size: 13px;
  }

  input[type="text"] {
    width: 100%;
    padding: 6px 8px;
    margin-top: 4px;
    border-radius: 4px;
    border: 1px solid #555;
    background: #2a2a3d;
    color: #f5f5f5;
    box-sizing: border-box;
  }

  .buttons {
    margin-top: 10px;
    display: flex;
    gap: 8px;
  }

  button {
    flex: 1;
    padding: 6px 0;
    border-radius: 6px;
    border: none;
    cursor: pointer;
    font-weight: 700;
    font-size: 13px;
  }

  #btnStart {
    background: #4caf50;
    color: #fff;
  }

  #btnStop {
    background: #f44336;
    color: #fff;
  }

  #status {
    margin-top: 8px;
    font-size: 12px;
  }

  .small {
    font-size: 10px;
    color: #ccccff;
    margin-top: 6px;
  }

  #launchersBox {
    margin-top: 10px;
    padding: 6px;
    border-radius: 6px;
    background: #25253a;
    font-size: 10px;
  }

  #launchersBox code {
    background: #333;
    padding: 1px 3px;
    border-radius: 3px;
  }

  #btnOpenLaunchers {
    margin-top: 4px;
    padding: 3px 6px;
    font-size: 10px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    background: #3f51b5;
    color: #fff;
  }

  .color-settings {
    padding: 10px;
    background: #25253a;
    border-radius: 8px;
    box-sizing: border-box;
    margin-bottom: 10px;
  }

  .color-settings h2 {
    font-size: 14px;
    margin: 0 0 8px 0;
    border-bottom: 1px solid #444;
    padding-bottom: 6px;
  }

  .color-row {
    display: flex;
    align-items: center;
    margin-bottom: 6px;
    gap: 8px;
  }

  .color-row label {
    flex: 1;
    margin: 0;
    font-size: 12px;
    min-width: 90px;
  }

  .color-row input[type="color"] {
    width: 32px;
    height: 24px;
    padding: 0;
    border: 2px solid #555;
    border-radius: 4px;
    cursor: pointer;
    background: transparent;
  }

  .color-row input[type="number"] {
    width: 50px;
    padding: 3px 5px;
    border-radius: 4px;
    border: 1px solid #555;
    background: #2a2a3d;
    color: #f5f5f5;
    font-size: 11px;
  }

  .color-row input[type="range"] {
    width: 60px;
    cursor: pointer;
  }

  .color-row input[type="checkbox"] {
    width: 16px;
    height: 16px;
    cursor: pointer;
  }

  .color-row select {
    flex: 1;
    max-width: 150px;
    padding: 3px 5px;
    border-radius: 4px;
    border: 1px solid #555;
    background: #2a2a3d;
    color: #f5f5f5;
    font-size: 11px;
    cursor: pointer;
  }

  .alpha-value {
    font-size: 10px;
    color: #aaa;
    width: 30px;
    text-align: right;
  }

  #btnResetColors {
    margin-top: 8px;
    padding: 5px 10px;
    font-size: 11px;
    border-radius: 4px;
    border: none;
    cursor: pointer;
    background: #666;
    color: #fff;
  }

  #btnResetColors:hover {
    background: #888;
  }

  .color-category {
    margin-top: 10px;
    font-size: 11px;
    color: #aaa;
    border-top: 1px solid #333;
    padding-top: 6px;
  }

  .color-category:first-of-type {
    margin-top: 0;
    border-top: none;
    padding-top: 0;
  }

  .effect-box {
    margin-top: 12px;
    padding: 8px;
    border-radius: 8px;
    background: #25253a;
    font-size: 12px;
  }
  .effect-box h2 {
    margin: 0 0 6px 0;
    font-size: 14px;
  }
  .effect-buttons {
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: 6px;
  }
  .effect-buttons button {
    padding: 8px 6px;
    font-weight: 700;
    background: #3f51b5;
    color: #fff;
    border: none;
    border-radius: 6px;
    cursor: pointer;
  }
  .effect-buttons button:hover {
    background: #5667d8;
  }
  #effectStatus {
    margin-top: 6px;
    font-size: 11px;
    color: #cdd0ff;
  }
</style>
</head>
<body>
<div class="container">
  <div class="left-panel">
    <h1>YouTube Chat Overlay</h1>

    <label>
      ãƒãƒ£ãƒ³ãƒãƒ«ID / @ãƒãƒ³ãƒ‰ãƒ« / å‹•ç”»ID
      <input type="text" id="inputTarget" placeholder="@ã™ãšãªã‚†ã„ / UCxxxx / abcdefghijk" />
    </label>

    <div class="buttons">
      <button id="btnStart">ãƒãƒ£ãƒƒãƒˆå–å¾—é–‹å§‹</button>
      <button id="btnStop">åœæ­¢</button>
    </div>

    <div id="status">ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: åœæ­¢ä¸­</div>

    <div id="launchersBox">
      <div id="launchersPath">OBS ç”¨ãƒ©ãƒ³ãƒãƒ£ãƒ¼ãƒ•ã‚©ãƒ«ãƒ€: æº–å‚™ä¸­â€¦</div>
      <button id="btnOpenLaunchers">ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ãï¼ˆãƒ‰ãƒ©ãƒƒã‚°ç”¨ï¼‰</button>
      <div class="small">
        ãƒ•ã‚©ãƒ«ãƒ€å†…ã® <code>*.html</code> ã‚’ OBS ã«ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ—
      </div>
    </div>

  </div>

  <div class="right-panel">
    <div class="settings-row">
      <!-- ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¨­å®š -->
      <div class="settings-col">
        <div class="color-settings">
          <h2>ğŸ“º é€šå¸¸ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¨­å®š</h2>

          <div class="color-row">
            <label>ãƒ•ã‚©ãƒ³ãƒˆ</label>
            <select id="fontFamily">
              <optgroup label="â€” Webãƒ•ã‚©ãƒ³ãƒˆ â€”">
                <option value="Noto Sans JP">Noto Sans JP</option>
                <option value="M PLUS Rounded 1c">M PLUS Rounded 1c</option>
                <option value="M PLUS 1p">M PLUS 1p</option>
                <option value="Kosugi Maru">å°æ‰ä¸¸ã‚´ã‚·ãƒƒã‚¯</option>
                <option value="Zen Maru Gothic">Zen Maru Gothic</option>
                <option value="BIZ UDGothic">BIZ UDã‚´ã‚·ãƒƒã‚¯</option>
                <option value="Klee One">Klee One</option>
                <option value="Yusei Magic">Yusei Magic</option>
                <option value="Hachi Maru Pop">ã¯ã¡ã¾ã‚‹ãƒãƒƒãƒ—</option>
              </optgroup>
              <optgroup label="â€” ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆ â€”">
                <option value="Yu Gothic">æ¸¸ã‚´ã‚·ãƒƒã‚¯</option>
                <option value="Meiryo">ãƒ¡ã‚¤ãƒªã‚ª</option>
                <option value="MS Gothic">MS ã‚´ã‚·ãƒƒã‚¯</option>
                <option value="Arial">Arial</option>
              </optgroup>
              <optgroup id="installedFontsGroup" label="â€” ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ â€”">
              </optgroup>
            </select>
          </div>
          <div class="color-row">
            <label>èƒŒæ™¯è‰²</label>
            <input type="color" id="colorNormal" value="#000000" />
            <input type="range" id="alphaNormal" min="0" max="100" value="100" />
            <span class="alpha-value" id="alphaNormalVal">100%</span>
          </div>
          <div class="color-row">
            <label>æ–‡å­—è‰²</label>
            <input type="color" id="colorText" value="#ffffff" />
            <input type="range" id="alphaText" min="0" max="100" value="100" />
            <span class="alpha-value" id="alphaTextVal">100%</span>
          </div>
          <div class="color-row">
            <label>æŠ•ç¨¿è€…å</label>
            <input type="color" id="colorAuthor" value="#ffd8f8" />
            <input type="range" id="alphaAuthor" min="0" max="100" value="100" />
            <span class="alpha-value" id="alphaAuthorVal">100%</span>
          </div>
          <div class="color-row">
            <label>ã‚µã‚¤ã‚º (px)</label>
            <input type="number" id="fontSize" value="22" min="10" max="48" />
          </div>
          <div class="color-row">
            <label>ã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚º (px)</label>
            <input type="number" id="avatarSize" value="40" min="16" max="120" />
          </div>
          <div class="color-row">
            <label>å¤ªå­—</label>
            <input type="checkbox" id="fontBold" checked />
          </div>
          <div class="color-row">
            <label>å½±</label>
            <input type="checkbox" id="shadowEnabled" checked />
            <input type="color" id="colorShadow" value="#000000" />
            <input type="range" id="alphaShadow" min="0" max="100" value="90" />
            <span class="alpha-value" id="alphaShadowVal">90%</span>
          </div>
          <div class="color-row">
            <label>ãƒ¡ãƒ³ãƒãƒ¼èƒŒæ™¯</label>
            <input type="color" id="colorMembership" value="#1e7d32" />
            <input type="range" id="alphaMembership" min="0" max="100" value="100" />
            <span class="alpha-value" id="alphaMembershipVal">100%</span>
          </div>
          <button id="btnResetColors">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™</button>
        </div>
      </div>

      <!-- ãƒ‹ã‚³ãƒ‹ã‚³é¢¨è¨­å®š -->
      <div class="settings-col">
        <div class="color-settings">
          <h2>ğŸ¬ ãƒ‹ã‚³ãƒ‹ã‚³é¢¨è¨­å®š</h2>

          <div class="color-row">
            <label>ãƒ•ã‚©ãƒ³ãƒˆ</label>
            <select id="nicoFontFamily">
              <optgroup label="â€” Webãƒ•ã‚©ãƒ³ãƒˆ â€”">
                <option value="Noto Sans JP">Noto Sans JP</option>
                <option value="M PLUS Rounded 1c">M PLUS Rounded 1c</option>
                <option value="M PLUS 1p">M PLUS 1p</option>
                <option value="Kosugi Maru">å°æ‰ä¸¸ã‚´ã‚·ãƒƒã‚¯</option>
                <option value="Zen Maru Gothic">Zen Maru Gothic</option>
                <option value="BIZ UDGothic">BIZ UDã‚´ã‚·ãƒƒã‚¯</option>
                <option value="Klee One">Klee One</option>
                <option value="Yusei Magic">Yusei Magic</option>
                <option value="Hachi Maru Pop">ã¯ã¡ã¾ã‚‹ãƒãƒƒãƒ—</option>
              </optgroup>
              <optgroup label="â€” ã‚·ã‚¹ãƒ†ãƒ ãƒ•ã‚©ãƒ³ãƒˆ â€”">
                <option value="Yu Gothic">æ¸¸ã‚´ã‚·ãƒƒã‚¯</option>
                <option value="Meiryo">ãƒ¡ã‚¤ãƒªã‚ª</option>
                <option value="MS Gothic">MS ã‚´ã‚·ãƒƒã‚¯</option>
                <option value="Arial">Arial</option>
                <option value="Impact">Impact</option>
              </optgroup>
              <optgroup id="nicoInstalledFontsGroup" label="â€” ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ â€”">
              </optgroup>
            </select>
          </div>
          <div class="color-row">
            <label>æ–‡å­—è‰²</label>
            <input type="color" id="nicoColorText" value="#ffffff" />
            <input type="range" id="nicoAlphaText" min="0" max="100" value="100" />
            <span class="alpha-value" id="nicoAlphaTextVal">100%</span>
          </div>
          <div class="color-row">
            <label>ã‚µã‚¤ã‚º (px)</label>
            <input type="number" id="nicoFontSize" value="64" min="20" max="200" />
          </div>
          <div class="color-row">
            <label>å¤ªå­—</label>
            <input type="checkbox" id="nicoFontBold" checked />
          </div>
          <div class="color-row">
            <label>æµã‚Œã‚‹é€Ÿåº¦ (ç§’)</label>
            <input type="number" id="nicoScrollDuration" value="8" min="3" max="20" step="0.5" />
          </div>
          <div class="color-row">
            <label>ç¸å–ã‚Š</label>
            <input type="checkbox" id="nicoShadowEnabled" checked />
            <input type="color" id="nicoColorShadow" value="#000000" />
            <input type="range" id="nicoAlphaShadow" min="0" max="100" value="100" />
            <span class="alpha-value" id="nicoAlphaShadowVal">100%</span>
          </div>
          <button id="btnResetNico">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™</button>
        </div>
      </div>

      <div class="settings-col">
        <div class="effect-box">
          <h2>âœ¨ ã‚¨ãƒ•ã‚§ã‚¯ãƒˆæ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼</h2>
          <div class="effect-buttons">
            <button data-effect="firework">èŠ±ç«</button>
            <button data-effect="snow">é›ª</button>
            <button data-effect="heart">ãƒãƒ¼ãƒˆ</button>
            <button data-effect="star">æµã‚Œæ˜Ÿ</button>
            <button data-effect="explosion">çˆ†ç™º</button>
            <button data-effect="tikuwa">ã¡ãã‚/é‰„ã‚¢ãƒ¬ã‚¤</button>
            <button data-effect="sirakaba">ã‚·ãƒ©ã‚«ãƒ</button>
          </div>
          <div id="effectStatus">ã‚¯ãƒªãƒƒã‚¯ã§ã‚¨ãƒ•ã‚§ã‚¯ãƒˆã‚’é€ä¿¡ã§ãã¾ã™ã€‚</div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  const { ipcRenderer } = require("electron");

  const inputTarget = document.getElementById("inputTarget");
  const btnStart = document.getElementById("btnStart");
  const btnStop = document.getElementById("btnStop");
  const statusEl = document.getElementById("status");

  const launchersPathEl = document.getElementById("launchersPath");
  const btnOpenLaunchers = document.getElementById("btnOpenLaunchers");
  const effectStatus = document.getElementById("effectStatus");

  const KEY = "yt-overlay-input";
  const EFFECT_ENDPOINT = "http://127.0.0.1:5000/trigger-effect";

  window.addEventListener("DOMContentLoaded", () => {
    const saved = localStorage.getItem(KEY);
    if (saved) {
      inputTarget.value = saved;
    }
  });

  btnStart.addEventListener("click", () => {
    const v = inputTarget.value.trim();
    if (!v) {
      statusEl.textContent = "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: å…¥åŠ›ãŒç©ºã§ã™";
      return;
    }

    localStorage.setItem(KEY, v);

    statusEl.textContent = "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: èµ·å‹•ä¸­â€¦";
    ipcRenderer.send("chat:start", v);
  });

  btnStop.addEventListener("click", () => {
    ipcRenderer.send("chat:stop");
    statusEl.textContent = "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: åœæ­¢è¦æ±‚ã‚’é€ä¿¡ã—ã¾ã—ãŸâ€¦";
  });

  // ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ã‹ã‚‰ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹é€šçŸ¥
  ipcRenderer.on("chat:status", (_event, state) => {
    if (state === "starting") {
      statusEl.textContent = "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: èµ·å‹•ä¸­â€¦";
    } else if (state === "stopped") {
      statusEl.textContent = "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: åœæ­¢ä¸­";
    } else {
      statusEl.textContent = "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: " + state;
    }
  });

  ipcRenderer.on("chat:error", (_event, message) => {
    statusEl.textContent = "ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ã‚¨ãƒ©ãƒ¼: " + message;
  });

  // ãƒ©ãƒ³ãƒãƒ£ãƒ¼ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ‘ã‚¹è¡¨ç¤º
  ipcRenderer.on("launchers:path", (_event, dirPath) => {
    launchersPathEl.textContent = "OBS ç”¨ãƒ©ãƒ³ãƒãƒ£ãƒ¼ãƒ•ã‚©ãƒ«ãƒ€: " + dirPath;
  });

  btnOpenLaunchers.addEventListener("click", () => {
    ipcRenderer.send("launchers:open");
  });

  // ã‚¨ãƒ•ã‚§ã‚¯ãƒˆæ‰‹å‹•ãƒˆãƒªã‚¬ãƒ¼
  async function triggerEffect(type) {
    if (!type) return;
    const label = {
      firework: "èŠ±ç«",
      snow: "é›ª",
      heart: "ãƒãƒ¼ãƒˆ",
      star: "æµã‚Œæ˜Ÿ",
      explosion: "çˆ†ç™º",
      tikuwa: "ã¡ãã‚/é‰„ã‚¢ãƒ¬ã‚¤",
      sirakaba: "ã‚·ãƒ©ã‚«ãƒ"
    }[type] || type;
    effectStatus.textContent = `${label} ã‚’é€ä¿¡ä¸­â€¦`;
    try {
      const res = await fetch(EFFECT_ENDPOINT, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ type }),
      });
      if (!res.ok) throw new Error(`HTTP ${res.status}`);
      effectStatus.textContent = `${label} ã‚’é€ä¿¡ã—ã¾ã—ãŸ`;
    } catch (e) {
      effectStatus.textContent = `${label} ã®é€ä¿¡ã«å¤±æ•—ã—ã¾ã—ãŸ: ${e?.message || e}`;
    }
  }

  document.querySelectorAll("[data-effect]").forEach((btn) => {
    btn.addEventListener("click", () => triggerEffect(btn.dataset.effect));
  });

  // ========== ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ãƒ•ã‚©ãƒ³ãƒˆæ¤œå‡º ==========
  async function detectInstalledFonts() {
    const installedGroup = document.getElementById("installedFontsGroup");
    const nicoInstalledGroup = document.getElementById("nicoInstalledFontsGroup");
    
    // Local Font Access API ãŒä½¿ãˆã‚‹å ´åˆ
    if ("queryLocalFonts" in window) {
      try {
        const fonts = await window.queryLocalFonts();
        const fontFamilies = new Set();
        for (const font of fonts) {
          fontFamilies.add(font.family);
        }
        
        // æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã‚’å„ªå…ˆçš„ã«è¡¨ç¤º
        const jpFonts = [];
        const otherFonts = [];
        
        for (const family of fontFamilies) {
          // æ—¢ã«ãƒªã‚¹ãƒˆã«ã‚ã‚‹ã‚‚ã®ã¯é™¤å¤–
          const existingOptions = document.querySelectorAll("#fontFamily option");
          let exists = false;
          for (const opt of existingOptions) {
            if (opt.value === family) {
              exists = true;
              break;
            }
          }
          if (exists) continue;
          
          // æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆã£ã½ã„ã‚‚ã®ã‚’åˆ¤å®š
          if (/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]|Gothic|Mincho|Meiryo|Yu|Hiragino|Noto.*JP|Source Han|ã‚´ã‚·ãƒƒã‚¯|æ˜æœ/.test(family)) {
            jpFonts.push(family);
          } else {
            otherFonts.push(family);
          }
        }
        
        jpFonts.sort();
        otherFonts.sort();
        
        for (const family of [...jpFonts, ...otherFonts].slice(0, 50)) {
          const option1 = document.createElement("option");
          option1.value = family;
          option1.textContent = family;
          installedGroup.appendChild(option1);

          const option2 = document.createElement("option");
          option2.value = family;
          option2.textContent = family;
          nicoInstalledGroup.appendChild(option2);
        }
      } catch (e) {
        console.log("Font detection not available:", e);
      }
    }
  }
  
  detectInstalledFonts();

  // ========== ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤è¨­å®š ==========
  const COLOR_KEY = "yt-overlay-colors";

  const defaultColors = {
    fontFamily: "Noto Sans JP",
    colorNormal: "#000000",
    alphaNormal: 100,
    colorText: "#ffffff",
    alphaText: 100,
    colorAuthor: "#ffd8f8",
    alphaAuthor: 100,
    fontSize: 22,
    avatarSize: 40,
    fontBold: true,
    shadowEnabled: true,
    colorShadow: "#000000",
    alphaShadow: 90,
    colorMembership: "#1e7d32",
    alphaMembership: 100
  };

  const colorInputs = {
    fontFamily: document.getElementById("fontFamily"),
    colorNormal: document.getElementById("colorNormal"),
    alphaNormal: document.getElementById("alphaNormal"),
    colorText: document.getElementById("colorText"),
    alphaText: document.getElementById("alphaText"),
    colorAuthor: document.getElementById("colorAuthor"),
    alphaAuthor: document.getElementById("alphaAuthor"),
    fontSize: document.getElementById("fontSize"),
    avatarSize: document.getElementById("avatarSize"),
    fontBold: document.getElementById("fontBold"),
    shadowEnabled: document.getElementById("shadowEnabled"),
    colorShadow: document.getElementById("colorShadow"),
    alphaShadow: document.getElementById("alphaShadow"),
    colorMembership: document.getElementById("colorMembership"),
    alphaMembership: document.getElementById("alphaMembership")
  };

  // ========== ãƒ‹ã‚³ãƒ‹ã‚³é¢¨è¨­å®š ==========
  const NICO_KEY = "yt-overlay-nico";

  const defaultNico = {
    fontFamily: "Noto Sans JP",
    colorText: "#ffffff",
    alphaText: 100,
    fontSize: 64,
    fontBold: true,
    scrollDuration: 8,
    shadowEnabled: true,
    colorShadow: "#000000",
    alphaShadow: 100
  };

  const nicoInputs = {
    fontFamily: document.getElementById("nicoFontFamily"),
    colorText: document.getElementById("nicoColorText"),
    alphaText: document.getElementById("nicoAlphaText"),
    fontSize: document.getElementById("nicoFontSize"),
    fontBold: document.getElementById("nicoFontBold"),
    scrollDuration: document.getElementById("nicoScrollDuration"),
    shadowEnabled: document.getElementById("nicoShadowEnabled"),
    colorShadow: document.getElementById("nicoColorShadow"),
    alphaShadow: document.getElementById("nicoAlphaShadow")
  };

  function updateAlphaDisplay() {
    // ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ç”¨
    const alphaKeys = ["alphaNormal", "alphaText", "alphaAuthor", "alphaShadow", "alphaMembership"];
    for (const key of alphaKeys) {
      const valEl = document.getElementById(key + "Val");
      if (valEl && colorInputs[key]) {
        valEl.textContent = colorInputs[key].value + "%";
      }
    }
    // ãƒ‹ã‚³ãƒ‹ã‚³ç”¨
    const nicoAlphaKeys = ["alphaText", "alphaShadow"];
    for (const key of nicoAlphaKeys) {
      const valEl = document.getElementById("nico" + key.charAt(0).toUpperCase() + key.slice(1) + "Val");
      if (valEl && nicoInputs[key]) {
        valEl.textContent = nicoInputs[key].value + "%";
      }
    }
  }

  function loadColorSettings() {
    const saved = localStorage.getItem(COLOR_KEY);
    const colors = saved ? JSON.parse(saved) : defaultColors;
    for (const key in colorInputs) {
      if (colorInputs[key].type === "checkbox") {
        colorInputs[key].checked = colors[key] ?? defaultColors[key];
      } else {
        colorInputs[key].value = colors[key] ?? defaultColors[key];
      }
    }
  }

  function loadNicoSettings() {
    const saved = localStorage.getItem(NICO_KEY);
    const nico = saved ? JSON.parse(saved) : defaultNico;
    for (const key in nicoInputs) {
      if (nicoInputs[key].type === "checkbox") {
        nicoInputs[key].checked = nico[key] ?? defaultNico[key];
      } else {
        nicoInputs[key].value = nico[key] ?? defaultNico[key];
      }
    }
  }

  function saveColorSettings() {
    const colors = {};
    for (const key in colorInputs) {
      if (colorInputs[key].type === "checkbox") {
        colors[key] = colorInputs[key].checked;
      } else {
        colors[key] = colorInputs[key].value;
      }
    }
    localStorage.setItem(COLOR_KEY, JSON.stringify(colors));
    updateAlphaDisplay();
    sendAllSettings();
  }

  function saveNicoSettings() {
    const nico = {};
    for (const key in nicoInputs) {
      if (nicoInputs[key].type === "checkbox") {
        nico[key] = nicoInputs[key].checked;
      } else {
        nico[key] = nicoInputs[key].value;
      }
    }
    localStorage.setItem(NICO_KEY, JSON.stringify(nico));
    updateAlphaDisplay();
    sendAllSettings();
  }

  function sendAllSettings() {
    const colorsSaved = localStorage.getItem(COLOR_KEY);
    const nicoSaved = localStorage.getItem(NICO_KEY);
    const colors = colorsSaved ? JSON.parse(colorsSaved) : defaultColors;
    const nico = nicoSaved ? JSON.parse(nicoSaved) : defaultNico;
    ipcRenderer.send("colors:update", { overlay: colors, nico: nico });
  }

  // å„å…¥åŠ›ã®å¤‰æ›´ã‚’ç›£è¦–
  for (const key in colorInputs) {
    colorInputs[key].addEventListener("input", saveColorSettings);
    colorInputs[key].addEventListener("change", saveColorSettings);
  }
  for (const key in nicoInputs) {
    nicoInputs[key].addEventListener("input", saveNicoSettings);
    nicoInputs[key].addEventListener("change", saveNicoSettings);
  }

  document.getElementById("btnResetColors").addEventListener("click", () => {
    for (const key in colorInputs) {
      if (colorInputs[key].type === "checkbox") {
        colorInputs[key].checked = defaultColors[key];
      } else {
        colorInputs[key].value = defaultColors[key];
      }
    }
    saveColorSettings();
  });

  document.getElementById("btnResetNico").addEventListener("click", () => {
    for (const key in nicoInputs) {
      if (nicoInputs[key].type === "checkbox") {
        nicoInputs[key].checked = defaultNico[key];
      } else {
        nicoInputs[key].value = defaultNico[key];
      }
    }
    saveNicoSettings();
  });

  // åˆæœŸèª­ã¿è¾¼ã¿
  loadColorSettings();
  loadNicoSettings();
  updateAlphaDisplay();
  // èµ·å‹•æ™‚ã«ç¾åœ¨ã®è¨­å®šã‚’ã‚µãƒ¼ãƒãƒ¼ã«é€ä¿¡
  setTimeout(() => {
    sendAllSettings();
  }, 500);
</script>
</body>
</html>
