<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>軽量版 雪エフェクト</title>
<style>
  body {
    margin: 0;
    overflow: hidden;
    background: radial-gradient(circle at 50% 0%, #223 0%, #050510 50%, #000 100%);
  }
  canvas {
    display: block;
  }
</style>
</head>
<body>
<canvas id="snowCanvas"></canvas>

<script>
  const canvas = document.getElementById("snowCanvas");
  const ctx = canvas.getContext("2d");

  // 画面サイズに合わせる
  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  window.addEventListener("resize", resize);
  resize();

  const particles = [];
  const SNOW_COUNT = 120;   // 普通の雪
  const SPARKLE_COUNT = 40; // キラキラ粒

  function createSnow(x, y) {
    return {
      type: "snow",
      x,
      y,
      r: 2 + Math.random() * 3,
      vy: 0.5 + Math.random() * 1.2,
      vx: -0.4 + Math.random() * 0.8,
      alpha: 0.5 + Math.random() * 0.5,
      twinkleSpeed: 0.002 + Math.random() * 0.003,
      twinkleOffset: Math.random() * Math.PI * 2
    };
  }

  function createSparkle(x, y) {
    return {
      type: "sparkle",
      x,
      y,
      r: 1.5 + Math.random() * 2,
      vy: 0.3 + Math.random() * 0.8,
      vx: -0.3 + Math.random() * 0.6,
      alpha: 0.6 + Math.random() * 0.4,
      twinkleSpeed: 0.004 + Math.random() * 0.004,
      twinkleOffset: Math.random() * Math.PI * 2
    };
  }

  // 初期生成
  for (let i = 0; i < SNOW_COUNT; i++) {
    particles.push(createSnow(Math.random() * canvas.width,
                              Math.random() * canvas.height));
  }
  for (let i = 0; i < SPARKLE_COUNT; i++) {
    particles.push(createSparkle(Math.random() * canvas.width,
                                 Math.random() * canvas.height));
  }

  function drawParticle(p, t) {
    // きらきら用のアルファゆらぎ
    const twinkle =
      0.5 + 0.5 * Math.sin(t * p.twinkleSpeed + p.twinkleOffset);
    const alpha = p.alpha * twinkle;

    ctx.save();
    ctx.globalAlpha = alpha;

    if (p.type === "snow") {
      // ふんわり光る雪
      ctx.fillStyle = "#ffffff";
      ctx.shadowBlur = 8;
      ctx.shadowColor = "rgba(255,255,255,0.8)";
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
      ctx.fill();
    } else {
      // キラキラ粒（星っぽく）
      ctx.fillStyle = "#ffffff";
      ctx.shadowBlur = 12;
      ctx.shadowColor = "rgba(255,255,255,1)";
      ctx.beginPath();
      ctx.moveTo(p.x, p.y - p.r);
      ctx.lineTo(p.x + p.r, p.y);
      ctx.lineTo(p.x, p.y + p.r);
      ctx.lineTo(p.x - p.r, p.y);
      ctx.closePath();
      ctx.fill();
    }

    ctx.restore();
  }

  function updateParticle(p) {
    p.y += p.vy;
    p.x += p.vx;

    // 画面外に出たら上に戻す
    if (p.y > canvas.height + 20) {
      p.y = -10;
      p.x = Math.random() * canvas.width;
    }
    if (p.x < -20) p.x = canvas.width + 10;
    if (p.x > canvas.width + 20) p.x = -10;
  }

  function loop(timestamp) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    for (const p of particles) {
      updateParticle(p);
      drawParticle(p, timestamp);
    }

    requestAnimationFrame(loop);
  }

  requestAnimationFrame(loop);
</script>

</body>
</html>
